! This configuration was generated by Jinja2 for Arista EOS
! Timestamp: {{ now().strftime('%Y-%m-%d %H:%M:%S') }}

{% if hostname is defined %}
hostname {{ hostname }}
{% endif %}

! Enable necessary features
{% if features is defined and features %}
{% for feature in features %}
feature {{ feature }}
{% endfor %}
{% endif %}

! VLAN Configuration
{% if vlans is defined and vlans %}
{% for vlan_id, vlan_name in vlans.items() %}
vlan {{ vlan_id }}
  name {{ vlan_name }}
{% endfor %}
{% endif %}

! Interface Configuration
{% if interfaces is defined and interfaces %}
{% for int_name, int_data in interfaces.items() %}
interface {{ int_name }}
{% if int_data.description is defined %}
  description {{ int_data.description }}
{% endif %}
{% if int_data.shutdown is defined and int_data.shutdown %}
  shutdown
{% elif int_data.shutdown is defined and not int_data.shutdown %}
  no shutdown
{% endif %}
{% if int_data.mode is defined %}
  switchport mode {{ int_data.mode }}
{% if int_data.mode == 'access' and int_data.access_vlan is defined %}
  switchport access vlan {{ int_data.access_vlan }}
{% endif %}
{% if int_data.mode == 'trunk' %}
{% if int_data.trunk_vlans is defined %}
  switchport trunk allowed vlan {{ int_data.trunk_vlans }}
{% endif %}
{% if int_data.native_vlan is defined %}
  switchport trunk native vlan {{ int_data.native_vlan }}
{% endif %}
{% endif %}
{% endif %}
{% if int_data.ip_address is defined %}
  no switchport
  ip address {{ int_data.ip_address }}
{% if int_data.ip_secondary is defined %}
  ip address {{ int_data.ip_secondary }} secondary
{% endif %}
{% endif %}
{% if int_data.mtu is defined %}
  mtu {{ int_data.mtu }}
{% endif %}
{% if int_data.speed is defined %}
  speed {{ int_data.speed }}
{% endif %}
{% if int_data.duplex is defined %}
  duplex {{ int_data.duplex }}
{% endif %}
{% if int_data.port_channel is defined %}
  channel-group {{ int_data.port_channel }} mode {{ int_data.channel_mode | default('active') }}
{% endif %}
{% if int_data.mlag_id is defined %}
  mlag {{ int_data.mlag_id }}
{% endif %}
{% endfor %}
{% endif %}

! Port-Channel Configuration
{% if port_channels is defined and port_channels %}
{% for po_id, po_data in port_channels.items() %}
interface Port-Channel{{ po_id }}
{% if po_data.description is defined %}
  description {{ po_data.description }}
{% endif %}
{% if po_data.shutdown is defined and po_data.shutdown %}
  shutdown
{% elif po_data.shutdown is defined and not po_data.shutdown %}
  no shutdown
{% endif %}
{% if po_data.mode is defined %}
  switchport mode {{ po_data.mode }}
{% if po_data.mode == 'access' and po_data.access_vlan is defined %}
  switchport access vlan {{ po_data.access_vlan }}
{% endif %}
{% if po_data.mode == 'trunk' %}
{% if po_data.trunk_vlans is defined %}
  switchport trunk allowed vlan {{ po_data.trunk_vlans }}
{% endif %}
{% if po_data.native_vlan is defined %}
  switchport trunk native vlan {{ po_data.native_vlan }}
{% endif %}
{% endif %}
{% endif %}
{% if po_data.ip_address is defined %}
  no switchport
  ip address {{ po_data.ip_address }}
{% endif %}
{% if po_data.mlag_id is defined %}
  mlag {{ po_data.mlag_id }}
{% endif %}
{% endfor %}
{% endif %}

! SVI Configuration
{% if svis is defined and svis %}
{% for vlan_id, svi_data in svis.items() %}
interface Vlan{{ vlan_id }}
{% if svi_data.description is defined %}
  description {{ svi_data.description }}
{% endif %}
{% if svi_data.shutdown is defined and svi_data.shutdown %}
  shutdown
{% elif svi_data.shutdown is defined and not svi_data.shutdown %}
  no shutdown
{% endif %}
{% if svi_data.ip_address is defined %}
  ip address {{ svi_data.ip_address }}
{% endif %}
{% if svi_data.ip_virtual_router is defined %}
  ip virtual-router address {{ svi_data.ip_virtual_router }}
{% endif %}
{% if svi_data.vrrp is defined %}
{% for group_id, vrrp_data in svi_data.vrrp.items() %}
  vrrp {{ group_id }}
    ip address {{ vrrp_data.ip_address }}
    priority {{ vrrp_data.priority | default(100) }}
{% if vrrp_data.preempt is defined and vrrp_data.preempt %}
    preempt
{% endif %}
{% if vrrp_data.track_interface is defined %}
    track {{ vrrp_data.track_interface }} decrement {{ vrrp_data.track_decrement | default(10) }}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

! Routing Configuration
{% if routing is defined %}
{% if routing.ospf is defined %}
{% for process_id, ospf_data in routing.ospf.items() %}
router ospf {{ process_id }}
{% if ospf_data.router_id is defined %}
  router-id {{ ospf_data.router_id }}
{% endif %}
{% if ospf_data.areas is defined %}
{% for area_id, area_data in ospf_data.areas.items() %}
{% for network in area_data.networks %}
  network {{ network.address }} area {{ area_id }}
{% endfor %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

{% if routing.bgp is defined %}
{% for asn, bgp_data in routing.bgp.items() %}
router bgp {{ asn }}
{% if bgp_data.router_id is defined %}
  router-id {{ bgp_data.router_id }}
{% endif %}
{% if bgp_data.log_neighbor_changes is defined and bgp_data.log_neighbor_changes %}
  bgp log-neighbor-changes
{% endif %}
{% if bgp_data.graceful_restart is defined and bgp_data.graceful_restart %}
  graceful-restart restart-time {{ bgp_data.graceful_restart_time | default(300) }}
{% endif %}
{% if bgp_data.address_families is defined %}
{% for afi_safi, af_data in bgp_data.address_families.items() %}
  address-family {{ afi_safi }}
{% if af_data.networks is defined %}
{% for network in af_data.networks %}
    network {{ network }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% if bgp_data.neighbors is defined %}
{% for neighbor_ip, neighbor_data in bgp_data.neighbors.items() %}
  neighbor {{ neighbor_ip }}
    remote-as {{ neighbor_data.remote_as }}
{% if neighbor_data.update_source is defined %}
    update-source {{ neighbor_data.update_source }}
{% endif %}
{% if neighbor_data.password is defined %}
    password {{ neighbor_data.password }}
{% endif %}
{% if neighbor_data.description is defined %}
    description {{ neighbor_data.description }}
{% endif %}
{% if neighbor_data.peer_group is defined %}
    peer-group {{ neighbor_data.peer_group }}
{% endif %}
{% if neighbor_data.address_families is defined %}
{% for afi_safi, af_data in neighbor_data.address_families.items() %}
    address-family {{ afi_safi }}
{% if af_data.send_community is defined and af_data.send_community %}
      send-community
{% endif %}
{% if af_data.route_map_in is defined %}
      route-map {{ af_data.route_map_in }} in
{% endif %}
{% if af_data.route_map_out is defined %}
      route-map {{ af_data.route_map_out }} out
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% if bgp_data.peer_groups is defined %}
{% for pg_name, pg_data in bgp_data.peer_groups.items() %}
  peer-group {{ pg_name }}
    remote-as {{ pg_data.remote_as }}
{% if pg_data.update_source is defined %}
    update-source {{ pg_data.update_source }}
{% endif %}
{% if pg_data.password is defined %}
    password {{ pg_data.password }}
{% endif %}
{% if pg_data.address_families is defined %}
{% for afi_safi, af_data in pg_data.address_families.items() %}
    address-family {{ afi_safi }}
{% if af_data.send_community is defined and af_data.send_community %}
      send-community
{% endif %}
{% if af_data.route_map_in is defined %}
      route-map {{ af_data.route_map_in }} in
{% endif %}
{% if af_data.route_map_out is defined %}
      route-map {{ af_data.route_map_out }} out
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% endif %}

! NTP Configuration
{% if ntp_servers is defined and ntp_servers %}
ntp server {{ ntp_servers | join(' prefer\nntp server ') }} prefer
{% endif %}

! AAA Configuration
{% if aaa_config is defined %}
{% if aaa_config.authentication_order is defined %}
aaa authentication login default group {{ aaa_config.authentication_order | join(' ') }} local
{% endif %}
{% if aaa_config.authorization_exec_order is defined %}
aaa authorization exec default group {{ aaa_config.authorization_exec_order | join(' ') }} local
{% endif %}
{% if aaa_config.accounting_exec_order is defined %}
aaa accounting exec default start-stop group {{ aaa_config.accounting_exec_order | join(' ') }}
{% endif %}
{% if aaa_config.tacacs_servers is defined %}
tacacs-server host {{ aaa_config.tacacs_servers | join(' timeout 5\ntacacs-server host ') }} timeout 5
{% if aaa_config.tacacs_key is defined %}
tacacs-server key {{ aaa_config.tacacs_key }}
{% endif %}
{% endif %}
{% if aaa_config.radius_servers is defined %}
radius-server host {{ aaa_config.radius_servers | join(' timeout 5\nradius-server host ') }} timeout 5
{% if aaa_config.radius_key is defined %}
radius-server key {{ aaa_config.radius_key }}
{% endif %}
{% endif %}
{% endif %}

! SNMP Configuration
{% if snmp_config is defined %}
snmp-server enable
{% if snmp_config.community is defined %}
snmp-server community {{ snmp_config.community.string }} view {{ snmp_config.community.view | default('full') }} rw
{% endif %}
{% if snmp_config.host_traps is defined %}
{% for host_ip, host_data in snmp_config.host_traps.items() %}
snmp-server host {{ host_ip }} traps version {{ host_data.version | default('2c') }} {{ host_data.community | default('') }}
{% endfor %}
{% endif %}
{% if snmp_config.location is defined %}
snmp-server location {{ snmp_config.location }}
{% endif %}
{% if snmp_config.contact is defined %}
snmp-server contact {{ snmp_config.contact }}
{% endif %}
{% endif %}

! Logging Configuration
{% if logging_config is defined %}
logging console level {{ logging_config.console_level | default('warnings') }}
{% if logging_config.servers is defined %}
{% for server_ip in logging_config.servers %}
logging host {{ server_ip }}
{% endfor %}
{% endif %}
{% if logging_config.source_interface is defined %}
logging source-interface {{ logging_config.source_interface }}
{% endif %}
{% endif %}

! Local Users
{% if local_users is defined %}
{% for username, user_data in local_users.items() %}
username {{ username }} privilege {{ user_data.privilege | default(15) }} secret {{ user_data.password }}
{% endfor %}
{% endif %}

! Management Access (e.g., SSH, Telnet)
{% if management is defined %}
{% if management.ssh is defined and management.ssh %}
management api http-https
  no shutdown
  {% if management.ssh_ip_access_group is defined %}
  ip access-group {{ management.ssh_ip_access_group }}
  {% endif %}
management ssh
  no shutdown
{% if management.ssh_local_auth is defined and management.ssh_local_auth %}
  authentication local
{% endif %}
{% endif %}
{% if management.telnet is defined and management.telnet %}
management telnet
  no shutdown
{% endif %}
{% endif %}

! Static Routes
{% if static_routes is defined and static_routes %}
{% for route in static_routes %}
ip route {{ route.prefix }} {{ route.mask }} {{ route.next_hop }} {% if route.interface is defined %}{{ route.interface }}{% endif %} {% if route.distance is defined %}{{ route.distance }}{% endif %}
{% endfor %}
{% endif %}

! IP Access-Lists
{% if access_lists is defined and access_lists %}
{% for acl_name, acl_rules in access_lists.items() %}
ip access-list {{ acl_name }}
{% for rule in acl_rules %}
  {{ rule }}
{% endfor %}
{% endfor %}
{% endif %}

! Route-Maps
{% if route_maps is defined and route_maps %}
{% for rm_name, rm_sequence in route_maps.items() %}
route-map {{ rm_name }} {{ rm_sequence.action | default('permit') }} {{ rm_sequence.sequence | default(10) }}
{% for match_key, match_value in rm_sequence.matches.items() %}
  match {{ match_key }} {{ match_value }}
{% endfor %}
{% for set_key, set_value in rm_sequence.sets.items() %}
  set {{ set_key }} {{ set_value }}
{% endfor %}
{% endfor %}
{% endif %}

! MLAG Configuration
{% if mlag_config is defined %}
mlag configuration
  domain-id {{ mlag_config.domain_id }}
  local-interface Vlan{{ mlag_config.local_interface_vlan }}
  peer-address {{ mlag_config.peer_address }}
  peer-link Port-Channel{{ mlag_config.peer_link_po_id }}
  {% if mlag_config.keepalive_interval is defined %}
  keepalive-interval {{ mlag_config.keepalive_interval }}
  {% endif %}
{% if mlag_config.reload_delay_mlag is defined %}
  reload-delay mlag {{ mlag_config.reload_delay_mlag }}
{% endif %}
{% if mlag_config.reload_delay_non_mlag is defined %}
  reload-delay non-mlag {{ mlag_config.reload_delay_non_mlag }}
{% endif %}
{% endif %}

! Loopback Interfaces
{% if loopbacks is defined and loopbacks %}
{% for loopback_id, loopback_data in loopbacks.items() %}
interface Loopback{{ loopback_id }}
{% if loopback_data.description is defined %}
  description {{ loopback_data.description }}
{% endif %}
{% if loopback_data.ip_address is defined %}
  ip address {{ loopback_data.ip_address }}
{% endif %}
{% endfor %}
{% endif %}

! VRF Configuration
{% if vrfs is defined and vrfs %}
{% for vrf_name, vrf_data in vrfs.items() %}
vrf definition {{ vrf_name }}
{% if vrf_data.description is defined %}
  description {{ vrf_data.description }}
{% endif %}
{% if vrf_data.rd is defined %}
  rd {{ vrf_data.rd }}
{% endif %}
{% if vrf_data.address_families is defined %}
{% for afi_safi, af_data in vrf_data.address_families.items() %}
  address-family {{ afi_safi }}
{% if af_data.route_targets is defined %}
{% for rt_type, rt_value in af_data.route_targets.items() %}
    route-target {{ rt_type }} {{ rt_value }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
{% if vrf_data.interfaces is defined %}
{% for int_name in vrf_data.interfaces %}
interface {{ int_name }}
  vrf forwarding {{ vrf_name }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

! Banner
{% if banner is defined %}
banner motd
{{ banner }}
EOF
{% endif %}
